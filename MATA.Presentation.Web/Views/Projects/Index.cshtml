@model MATA.Presentation.Web.Models.Projects.ProjectsIndexVM

@{
    ViewBag.Title = "Projeler";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>
    Projeler
</h2>

<p class="text-right">
    @Html.ActionLink("Yeni Oluştur", "_Create", null, new { id = "mt-link-projects-create", @class = "btn btn-default" })
</p>

<div class="panel panel-default">
    <div class="panel-body">


        @{
            WebGrid grid = new WebGrid(
                rowsPerPage: Model.PageSize,
                ajaxUpdateContainerId: "project-grid",
                ajaxUpdateCallback: "InitGridEvents"
            );

            grid.Bind(Model.Projects, autoSortAndPage: false, rowCount: Model.TotalCount);
        }

        @grid.GetHtml(
            htmlAttributes: new { id = "project-grid" },
            tableStyle: "table table-hover",
            columns: new List<WebGridColumn>()
            {
                new WebGridColumn
                {
                    Header = "Ülke Adı",
                    ColumnName = "CountryName",
                    CanSort = false,
                    //Style = "width: 300px"
                },
                new WebGridColumn
                {
                    Header = "Proje Adı",
                    ColumnName = "ProjectName",
                    CanSort = false,
                    //Style = "width: 300px"
                },
                new WebGridColumn
                {
                    Header = "Açıklamalar",
                    ColumnName = "Remarks",
                    CanSort = false
                },
                new WebGridColumn
                {
                    Header = "Oluşturan",
                    ColumnName = "CreatedBy",
                    CanSort = false
                },
                new WebGridColumn
                {
                    Header = "Oluşturulma Zamanı",
                    ColumnName = "CreateTime",
                    CanSort = false
                },
                new WebGridColumn
                {
                    //Style = "auto-width",
                    Format = (item) => Html.ActionLink("Detay", "Details", new { id = item.ID })
                },
                new WebGridColumn
                {
                    //Style = "auto-width",
                    Format = (item) => Html.ActionLink("Güncelle", "_Edit", new { id = item.ID }, new { @class = "mt-link-projects-edit", data_project_id = item.ID })
                }
            },
            mode: WebGridPagerModes.Numeric,
            numericLinksCount: 5
        )

    </div>
</div>

@section scripts {

    @Scripts.Render("~/bundles/jqueryval")

    <script src="~/ts/mata.projects-controller.js"></script>

    <script type="text/javascript">

        $(function () {
            InitGridEvents();
        });

        function InitGridEvents() {

            $('#mt-link-projects-create').click(function (e) {
                e.preventDefault();
                MATA.Projects.openCreateModal();
                return false;
            });

            $('.mt-link-projects-edit').click(function (e) {
                e.preventDefault();
                var $this = $(this),
                    projectID = $this.data("projectId");
                MATA.Projects.openEditModal(projectID);
                return false;
            });
        }

    </script>
}
